Some tricky bits:


The X chromosome!
  When it's a boy, we only look at the mother, missing data in the father doesn't matter any more. And the expectation only depends on the mother. For girls, though, the expectation depends on both father and mother, but there is no variability in what's inherited from the father.

So:
 
The validate marker code could probably be better,
And the expectation code when we have an X-chromosome could be improved.
